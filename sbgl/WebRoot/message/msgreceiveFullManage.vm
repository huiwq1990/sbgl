
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>管理</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="${cssDomain}/bootstrap.css" rel="stylesheet" type="text/css" />
<link href="${cssDomain}/global.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="${cssDomain}/jqpagination.css" type="text/css" />

<!--[if lt IE 10]>
  <script src="../js/jquery.placeholder.js"></script>
  <script>
  $('input, textarea').placeholder();
  </script>
<![endif]-->
<!--[if lt IE 9]>
  <script src="../js/html5shiv.js"></script>
  <script src="../js/respond.min.js"></script>
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="css/font-awesome-ie7.min.css">
<![endif]-->
</head>

<body id="admin">
<header id="header-wrap"><!--header-wrap-->
  <div class="nav-wrap clearfix">
    <div class="site-nav">
      <div class="dropdown">
        <a class="pos dropdown-toggle" data-hover="dropdown" href="#"><i class="icon-home"></i> 管理中心 <i class="icon-chevron-right"></i></a><!-- #BeginLibraryItem "/Library/siteNav.lbi" -->
        <!--
		<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
          <li><a href="http://google.com"><i class="icon-home"></i> 首页</a></li>
          <li class="divider"></li>
          <li><a href="#anotherAction">个人主页</a></li>
          <li><a href="#">通讯录</a></li>
          <li class="divider"></li>
          <li><a href="../预约首页.html">我的预约</a></li>
          <li><a href="../消息中心-站内信.html">站内信</a></li>
          <li class="divider"></li>
          <li><a href="管理中心首页.html">管理中心</a></li>
        </ul>--><!-- #EndLibraryItem --></div>
    </div>
    <div class="sub-nav">
      <ul class="nav nav-tabs nav-tabs-google">
        <li><a href="#">首页</a></li>
        <li><a href="#">设置</a></li>
        <li><a href="用户管理首页.html">用户</a></li>
        <li class="active"><a href="设备管理首页.html">器材</a></li>
        <li><a href="#">内容</a></li>
      </ul>
    </div>    
    <ul class="account-wrap nav nav-pills pull-right">
          <li class="notice dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="icon-bell icon-large"></i><span class="n-num label label-important">3</span></a>
            <ul class="dropdown-menu">
              <li><a href="#">消息1</a></li>
              <li><a href="#">消息2</a></li>
            </ul>
          </li>     
          <li class="social dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="username">admin</span><img src="../img/photo.jpg" width="32" height="32" class="img-circle"> <b class="caret"></b></a>
            <div class="dropdown-menu">
              <div class="media">
                <a class="pull-left" href="#">
                  <img src="../img/photo.jpg" width="96" height="96" class="img-rounded">
                </a>
                <div class="media-body">
                  <div class="media-heading"><h5><a href="#">admin</a></h5></div>
                  <div class="info"></div>
                  <div class="setting"><a href="#">账户设置</a></div>
                  <button class="btn btn-primary" type="button">查看个人主页</button>
                </div>
              </div>
            </div>      
          </li>
        </ul>
  </div>
</header><!--/#header-wrap-->
<section id="main-wrap" class="clearfix"><!--main-wrap-->

      <ul class="nav nav-tabs">
        <li><a href="">其他管理</a></li>
        <li class="active"><a href="">管理</a></li>
      </ul>
      <!--admin-wrap start-->
      <div id="admin-wrap">
        <div id="admin-content" class="clearfix">            
            <div class="control-bar clearfix"><!--control-bar start-->
              <div class="title pull-left">管理</div>
			  <div class="tips">在此页面下管理信息，如设备的添加、修改、删除及维护等。</div>
			  <!--
              <div class="filter category-filter">
                <select id="select-categories" style="width:130px" class="select2">
                  <option value="0" data-foo="fa">全部分类</option>
                  <option value="1" data-foo="fa">摄影摄像机</option>
                  <option value="2" data-foo="sub">数字摄影机</option>
                  <option value="3" data-foo="sub">数字摄像机</option>
                  <option value="4" data-foo="sub">单反</option>
                  <option value="5" data-foo="fa">灯具</option>
                  <option value="6" data-foo="sub">钨丝灯</option>
                  <option value="7" data-foo="sub">镝灯</option>
                </select>
              </div>
              -->
              <div class="operate-item pull-left">
                <a href="" class="btn btn-primary">添加</a>
                <a href="#" class="btn btn-white s-h" action-type="deleteMsgreceiveButton"><i class="icon-trash"></i> 删除</a>
              </div>
				
			  <!--
              <div class="page pull-right clearfix">
                <ul class="page-index nav nav-pills pull-left">
                  <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" role="button" href="#">第1/3页 <b class="caret"></b></a>
                    <ul class="dropdown-menu" role="menu">
                      <li><a href="#">最新</a></li>
                      <li><a href="#">最旧</a></li>
                    </ul>
                  </li>              
                </ul>
                <div class="pagination pull-right">
                  <ul>
                    <li><a href="#" rel="tooltip" data-placement="bottom" data-original-title="较新"><i class="icon-chevron-left"></i></a></li>
                    <li><a href="#" rel="tooltip" data-placement="bottom" data-original-title="较旧"><i class="icon-chevron-right"></i></a></li>
                  </ul>
                </div>              
              </div>
              <ul class="status-filter nav nav-pills pull-right">
                <li class="active"><a href="#">全部(10)（无不显示）</a></li>
                <li><a href="#">正常(5)</a></li>
                <li><a href="#">借出(2)</a></li>
                <li><a href="#">维护(2)</a></li>
                <li><a href="#">维修(2)</a></li>
                <li><a href="#">遗失(2)</a></li>
                <li><a href="#">回收站(1)</a></li>
              </ul>
			  -->
            </div><!--control-bar end-->
            <div class="panel panel-default table-responsive">

	<div id="refreshMsgreceiveTableDiv"> <!-- 刷新-->

<!--管理内容从这里开始 -->
<div id = "tablecon">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th class="chk-column"><input class="chk" id="chk-all" type="checkbox" rel="tooltip" data-original-title="全选"></th>

             <th class="msgreceiveid">msgreceiveid</th>
             <th class="msgreceivesenderid">msgreceivesenderid</th>
             <th class="msgreceivereceiverid">msgreceivereceiverid</th>
             <th class="msgreceivetitle">msgreceivetitle</th>
             <th class="msgreceivecontent">msgreceivecontent</th>
             <th class="msgreceivetype">msgreceivetype</th>
             <th class="msgreceivesendtime">msgreceivesendtime</th>
             <th class="msgreceivereadtime">msgreceivereadtime</th>
             <th class="msgreceivestatus">msgreceivestatus</th>
             <th class="senderid">senderid</th>
             <th class="senderuserid">senderuserid</th>
             <th class="sendername">sendername</th>
             <th class="senderroletype">senderroletype</th>
             <th class="senderprivilege">senderprivilege</th>
             <th class="senderpassword">senderpassword</th>
             <th class="receiverid">receiverid</th>
             <th class="receiveruserid">receiveruserid</th>
             <th class="receivername">receivername</th>
             <th class="receiverroletype">receiverroletype</th>
             <th class="receiverprivilege">receiverprivilege</th>
             <th class="receiverpassword">receiverpassword</th>
<!--
                   <th class="name">View</th>
				   <th class="name">Del</th>
				   <th class="name">Edit</th>
-->				   
                  </tr>
                </thead>
                <tbody>					
							

#foreach($tempmsgreceive in $msgreceiveFullList)
                  <tr>
                   <td><input class="chk" type="checkbox" name="chk-list" value="$!tempmsgreceive.msgreceiveid"></td>
					<!--修改属性-->
                    <td>$!tempmsgreceive.msgreceiveid<a class="btn btn-white btn-mini" data-toggle="modal" href="#modify-status" role="button" action-type="editMsgreceiveFillIn" 
						
						
																								data-id="$!tempmsgreceive.msgreceiveid"                           
												data-senderid="$!tempmsgreceive.msgreceivesenderid"                           
												data-receiverid="$!tempmsgreceive.msgreceivereceiverid"                           
												data-title="$!tempmsgreceive.msgreceivetitle"                           
												data-content="$!tempmsgreceive.msgreceivecontent"                           
												data-type="$!tempmsgreceive.msgreceivetype"                           
												data-sendtime="$!tempmsgreceive.msgreceivesendtime"                           
												data-readtime="$!tempmsgreceive.msgreceivereadtime"                           
												data-status="$!tempmsgreceive.msgreceivestatus"                           
												>修改</a></td>    
						

<td>$!tempmsgreceive.msgreceivesenderid</td>
<td>$!tempmsgreceive.msgreceivereceiverid</td>
<td>$!tempmsgreceive.msgreceivetitle</td>
<td>$!tempmsgreceive.msgreceivecontent</td>
<td>$!tempmsgreceive.msgreceivetype</td>
<td>$!tempmsgreceive.msgreceivesendtime</td>
<td>$!tempmsgreceive.msgreceivereadtime</td>
<td>$!tempmsgreceive.msgreceivestatus</td>
<!--
					<td><a href="${webbaseurl}/viewMsgreceiveFull.action?id=$!tempmsgreceive.msgreceiveid">查看</a></td> 
					<td><a href="${webbaseurl}/deleteMsgreceiveFull.action?id=$!tempmsgreceive.msgreceiveid">删除</a></td>			
					<td><a href="${webbaseurl}/editMsgreceiveFull.action?id=$!tempmsgreceive.msgreceiveid">修改</a></td>
-->                 
                  </tr>
#end            
           
                </tbody>
              </table>
 </div> 
				
				 <!--page -->
                          <div class="pagination">
                                <a href="#" class="first" data-action="first">&laquo;</a>
                                <a href="#" class="previous" data-action="previous">&lsaquo;</a>
                                <input type="text" readonly="readonly" data-max-page="$page.totalpage" />
                                <a href="#" class="next" data-action="next">&rsaquo;</a>
                                <a href="#" class="last" data-action="last">&raquo;</a>
                          </div>
                          <!-- end page -->
				
				</div><!-- end refreshTable-->

            </div>
          </div>

      </div>
      <!--equip-wrap end-->
	  
	  
       <div id="lside">
        <form class="form-group">
          <input type="text" class="form-control" placeholder="搜索">
          <i class="icon-search"></i>
        </form>
        <div class="list-group">
          <a href="${webbaseurl}/manageMsgreceiveFull.action" class="list-group-item">管理</a>
          <a href="${webbaseurl}/message/msgreceiveAdd.vm" class="list-group-item">添加</a>
          
        </div>
      </div>
      <!--sidebar end-->




</section>





<!-- Modal -->
<div id="modify-status" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none; ">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="icon-remove"></i></button>
    <h3 id="myModalLabel">修改</h3>
  </div>
  
  <div class="modal-body">
      <p>修改信息。</p>
      <form class="form-horizontal" role="form">
		
							
			<div class="form-group">
          <label for="id" class="col-xs-3 control-label">id</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceiveid" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="senderid" class="col-xs-3 control-label">senderid</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivesenderid" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="receiverid" class="col-xs-3 control-label">receiverid</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivereceiverid" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="title" class="col-xs-3 control-label">title</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivetitle" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="content" class="col-xs-3 control-label">content</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivecontent" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="type" class="col-xs-3 control-label">type</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivetype" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="sendtime" class="col-xs-3 control-label">sendtime</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivesendtime" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="readtime" class="col-xs-3 control-label">readtime</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivereadtime" placeholder="" value="">
          </div>
        </div>
				
			<div class="form-group">
          <label for="status" class="col-xs-3 control-label">status</label>
          <div class="col-xs-7">
            <input type="text" class="form-control" id="inputEditMsgreceivestatus" placeholder="" value="">
          </div>
        </div>
	      </form>
    </div>
  <div class="modal-footer">
    <button class="btn btn-white" data-dismiss="modal" aria-hidden="true">取 消</button>
    <button class="btn btn-primary" action-type="updateMsgreceiveButton">确 定</button>
  </div>
</div>


    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<script src="${jsDomain}/jquery.js"></script>
<script src="${jsDomain}/loader.min.js"></script>
<script src="${jsDomain}/select2.js"></script>
<script src="${jsDomain}/bootstrap-hover-dropdown.min.js"></script>
<script src="${jsDomain}/bfa.js"></script>
<script src="${jsDomain}/jquery.noty.js"></script>
<script src="${jsDomain}/jquery.jqpagination.js"></script>
<script>
	$("#modifyFaCategoryId").select2("val","2");
</script>



<script>
//	当前页
	var currentpagenum=1;
	var totalpage=$page.totalpage;

	var cookie = { 
  		//读取COOKIES,n为COOKIE名 
   		Get:function(n){ 
       		var re=new RegExp(n+'=([^;]*);?','gi');
       	    var r=re.exec(document.cookie)||[];
       	    return (r.length>1?r[1]:null)
   		}
	};

//	换页时调用方法
	$('.pagination').jqPagination({
    	paged: function(page) {
        	// do something with the page variable
       		currentpagenum = page;
        	refreshComputerTable();
        }
    });	
	
//	选择修改按钮，填充修改弹出框
	$("body").on("click", "a[action-type|=editMsgreceiveFillIn]", function() {
		var data = $(this).data();
							$("#inputEditMsgreceiveid").val(data.id);       
			var editid = data.id;
					$("#inputEditMsgreceivesenderid").val(data.senderid);       
			var editsenderid = data.senderid;
					$("#inputEditMsgreceivereceiverid").val(data.receiverid);       
			var editreceiverid = data.receiverid;
					$("#inputEditMsgreceivetitle").val(data.title);       
			var edittitle = data.title;
					$("#inputEditMsgreceivecontent").val(data.content);       
			var editcontent = data.content;
					$("#inputEditMsgreceivetype").val(data.type);       
			var edittype = data.type;
					$("#inputEditMsgreceivesendtime").val(data.sendtime);       
			var editsendtime = data.sendtime;
					$("#inputEditMsgreceivereadtime").val(data.readtime);       
			var editreadtime = data.readtime;
					$("#inputEditMsgreceivestatus").val(data.status);       
			var editstatus = data.status;
			})
//end 	editMsgreceiveFillIn


//	update
	$("body").on("click", "button[action-type|=updateMsgreceiveButton]", function() {
		var _this = $(this);
		var actionUrl = "${webbaseurl}/updateMsgreceiveAjax.action";
		//获取修改的值	
							var id = $("#inputEditMsgreceiveid").val();      
					var senderid = $("#inputEditMsgreceivesenderid").val();      
					var receiverid = $("#inputEditMsgreceivereceiverid").val();      
					var title = $("#inputEditMsgreceivetitle").val();      
					var content = $("#inputEditMsgreceivecontent").val();      
					var type = $("#inputEditMsgreceivetype").val();      
					var sendtime = $("#inputEditMsgreceivesendtime").val();      
					var readtime = $("#inputEditMsgreceivereadtime").val();      
					var status = $("#inputEditMsgreceivestatus").val();      
					
		var postData = {
										
								id: id,
											
								senderid: senderid,
											
								receiverid: receiverid,
											
								title: title,
											
								content: content,
											
								type: type,
											
								sendtime: sendtime,
											
								readtime: readtime,
											
								status: status
									}
			
			
		jQuery.ajax({  
		    url: actionUrl,  
		    type: "post",
		    data: postData,
		    dataType: 'json',
			success: function(data){
				var returnJson = jQuery.parseJSON(data); 
				if(returnJson.flag == 1){
					var n = noty({text: returnJson.reason, timeout: 2500, type: 'success'});					
					_this.parents('.modal').modal('toggle');		// 提交成功，关闭模态对话框		
					refreshTable();
				}else{
					var n = noty({text: returnJson.reason, timeout: 2500, type: 'error'});
				}
			}		  	  
		});//end jquery 

	})
//end update
	
	
	
	var idsForDel;	
	/* 处理CheckBox选中事件用于删除处理 */
	$("input[type='checkbox']").click(function() {
		//var num = 0;
		idsForDel = "";
		
		if($(this).attr("id") === "chk-all") {
			$("input[name='chk-list']").prop("checked",$(this).prop("checked"));
		}
		$("input[name='chk-list']").each(function() {
			if($(this).prop("checked") === true) {
				//num++;
				idsForDel += $(this).prop("value") + ";";
			}
		});
	});
	//end box
	
//	delete
	$("body").on("click", "a[action-type|=deleteMsgreceiveButton]", function() {
		idsForDel = idsForDel.substring(0,idsForDel.length-1);
		var postData = {
			msgreceiveIdsForDel: idsForDel
		}
		//alert(idsForDel);
		jQuery.ajax({  
		    url:"${webbaseurl}/deleteMsgreceiveFullAjax.${strutsaction}",  
		    type:"post",
		    data:postData,
			dataType: 'json',
			success: function(data){
				var returnJson = jQuery.parseJSON(data); 

				if(returnJson.flag == 1){
					var n = noty({text: returnJson.reason, timeout: 2500, type: 'success'});					
					$(this).parents('.modal').modal('toggle');		// 提交成功，关闭模态对话框	
					refreshTable();
				}else{
					var n = noty({text: failedStr, timeout: 2500, type: 'error'});
				}

			}		  	  
		});// end jquery
	})
//end delete


//	刷新数据
	function refreshTable(){
		jQuery.ajax({  
        	url: '${webbaseurl}/manageMsgreceiveFull.action',  
            type: "post",
            data:{ 
				pageNo:currentpagenum,
                callType:'ajaxType'
               
            },
            dataType: 'html',
            success: function(data){
            	$('#refreshMsgreceiveTableDiv').html(data);
                //设置分页绑定事件
                $('.pagination').jqPagination({
                	link_string : '/?page={page_number}',
                    max_page : totalpage,
                    current_page:currentpagenum,
                    paged: function(page) {               
                    	currentpagenum = page;
                        refreshTable();                
                    }
                 });
            }// end success                       
       	});// end jquery                
	}//end refreshTable
	
	
//  刷新后，绑定删除按钮	
	$("body").on("click", "input[type='checkbox']", function() {
                var num = 0;
                if($(this).attr("id") === "chk-all") {
                        $("input[name='chk-list']").prop("checked",$(this).prop("checked"));
                }
                $("input[name='chk-list']").each(function() {
                        if($(this).prop("checked") === true){
                                num++;  
                        }
                });
                if(num > 0){
                        $(".s-h").css({
                                "visibility": "visible",
                                "opacity": "1",
                                "filter": "alpha(opacity=100)"
                        });
                } else {
                        $(".s-h").css({
                                "visibility": "hidden",
                                "opacity": "0",
                                "filter": "alpha(opacity=0)"
                        });
                }
                
                idsForDel = "";
                
                $("input[name='chk-list']").each(function() {
                        if($(this).prop("checked") === true) {
                                //num++;
                                idsForDel += $(this).prop("value") + "_";
                        }
                });
        });
// end checkbox		
	
	
	
	
	
// 触发提交按钮事件
$('.modal').on('click', ('button.btn-primary'), function () {		
		var _this = $(this);

		//处理添加
		if(_this.attr('action-type') == 'addComputercategoryButton')
		{
			//alert('test add');
			var actionUrl = "${webbaseurl}/addComputercategoryAjax.action";
			var inputCategoryName = $('#addComputercategoryName').val();			
			var postData = {
				"createuserid": cookie.Get("id"),
				"name": inputCategoryName		
			}
			var successStr = "添加分类成功！";
			var failedStr = "添加分类失败！";				
		}
		// ebd add
		
		//处理update
		
		/*if(_this.attr('action-type') == 'updateMsgreceiveButton')
		{
			//alert('test add');
			var actionUrl = "${webbaseurl}/updateMsgreceiveAjax.action";
												var id = $("#inputEditMsgreceiveid").val();      
								var senderid = $("#inputEditMsgreceivesenderid").val();      
								var receiverid = $("#inputEditMsgreceivereceiverid").val();      
								var title = $("#inputEditMsgreceivetitle").val();      
								var content = $("#inputEditMsgreceivecontent").val();      
								var type = $("#inputEditMsgreceivetype").val();      
								var sendtime = $("#inputEditMsgreceivesendtime").val();      
								var readtime = $("#inputEditMsgreceivereadtime").val();      
								var status = $("#inputEditMsgreceivestatus").val();      
						var postData = {
													id: id,
									senderid: senderid,
									receiverid: receiverid,
									title: title,
									content: content,
									type: type,
									sendtime: sendtime,
									readtime: readtime,
									status: status,
							}
		}*/
		//end update
		
		
		
		// 如果是其它的提交操作，对照上一行的if代码处理		
		
		// 提交处理
		jQuery.ajax({  
		    url: actionUrl,  
		    type: "post",
		    data: postData,
		    dataType: 'json',
			success: function(data){
				var returnJson = jQuery.parseJSON(data); 
				if(returnJson.flag == 1){
					var n = noty({text: returnJson.reason, timeout: 2500, type: 'success'});					
					_this.parents('.modal').modal('toggle');		// 提交成功，关闭模态对话框		
					
				}else{
					var n = noty({text: returnJson.reason, timeout: 2500, type: 'error'});
				}
			}		  	  
		});		
	})	
	
	
	
</script>


</body>
</html>
